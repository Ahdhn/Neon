
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for project Neon">
      
      
      
        <link rel="canonical" href="https://example.com/learn/introduction/04-the-domain-level/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.3.1, mkdocs-material-8.4.1">
    
    
      
        <title>The Domain Level - Neon</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.69437709.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Ubuntu";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-domain-level" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Neon" class="md-header__button md-logo" aria-label="Neon" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Neon
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              The Domain Level
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="lime" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Autodesk/Neon" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Neon" class="md-nav__button md-logo" aria-label="Neon" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Neon
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Autodesk/Neon" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Github
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Neon's home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Learn
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Learn" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Learn
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" type="checkbox" id="__nav_2_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_1">
          Introduction and tutorials
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Introduction and tutorials" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Introduction and tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../01-neon-structure/" class="md-nav__link">
        Structure of the Library
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../02-the-system-level/" class="md-nav__link">
        The System Level
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../03-the-set-level/" class="md-nav__link">
        The Set Level
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          The Domain Level
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        The Domain Level
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#working-with-dense-domains" class="md-nav__link">
    Working with dense domains
  </a>
  
    <nav class="md-nav" aria-label="Working with dense domains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#neon-backend-choosing-the-hardware-for-the-computation" class="md-nav__link">
    Neon backend: choosing the hardware for the computation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neon-grid-setting-up-the-cartesian-discretisation" class="md-nav__link">
    Neon grid: setting up the cartesian discretisation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neon-field-defining-data-over-the-cartesian-discretisation" class="md-nav__link">
    Neon field: defining data over the cartesian discretisation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neon-map-containers-expanding-the-sphere-via-a-level-set" class="md-nav__link">
    Neon map containers: expanding the sphere via a level set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neon-stencil-containers-computing-the-grad-of-the-level-set-field" class="md-nav__link">
    Neon stencil containers: computing the grad of the level set field
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../05-the-skeleton-level/" class="md-nav__link">
        The Skeleton Level
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          Advanced Mechanisms
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Advanced Mechanisms" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Advanced Mechanisms
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../advanced-mechanisms/multi-resolution/" class="md-nav__link">
        Multi-resolution
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../examples/mandelbrot/" class="md-nav__link">
        Mandelbrot
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          References
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="References" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          References
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/papers-presentations/" class="md-nav__link">
        Papers and Presentations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/api-documentation/" class="md-nav__link">
        API Documentation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/performance-considerations/" class="md-nav__link">
        Performance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Community
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Community" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Community
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../CONTRIBUTING/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../CONTRIBUTORS/" class="md-nav__link">
        Contributors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../maintainers/" class="md-nav__link">
        Maintainers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#working-with-dense-domains" class="md-nav__link">
    Working with dense domains
  </a>
  
    <nav class="md-nav" aria-label="Working with dense domains">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#neon-backend-choosing-the-hardware-for-the-computation" class="md-nav__link">
    Neon backend: choosing the hardware for the computation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neon-grid-setting-up-the-cartesian-discretisation" class="md-nav__link">
    Neon grid: setting up the cartesian discretisation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neon-field-defining-data-over-the-cartesian-discretisation" class="md-nav__link">
    Neon field: defining data over the cartesian discretisation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neon-map-containers-expanding-the-sphere-via-a-level-set" class="md-nav__link">
    Neon map containers: expanding the sphere via a level set
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#neon-stencil-containers-computing-the-grad-of-the-level-set-field" class="md-nav__link">
    Neon stencil containers: computing the grad of the level set field
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
  <a href="https://github.com/Autodesk/Neon/edit/master/docs/learn/introduction/04-the-domain-level.md" title="Edit this page" class="md-content__button md-icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>



<p><img align="right" alt="" src="../img/04-layers-domain.png" style="width:250px" /></p>
<h1 id="the-domain-level">The Domain Level</h1>
<p>Neon Domain level&rsquo;s goal is to provide users with simple mechanisms for some specific domains.
Currently, Neon focus on those domains where a regular cartesian discretisations are leveraged.
Using a simple example will look ad how the level mechanisms can be used.</p>
<h2 id="working-with-dense-domains">Working with dense domains</h2>
<p>Let&rsquo;s use implicit geometries to showcase some aspect of Neon.
We&rsquo;ll be working on a dense domain on top of whihc we define our implicit geometry,
like a simple sphere. In the rest of this page, we&rsquo;ll be looking at the following tasks:</p>
<ol>
<li><a href="#backend">Choosing the hardware for the computation - <strong>Neon backend</strong></a></li>
<li><a href="#cartesian">Setting up a dense cartesian domain - <strong>Neon grid</strong></a></li>
<li><a href="#field">Initializing a sphere through its sdf - <strong>Neon field</strong></a></li>
<li><a href="#mapContainers">Expanding the sphere via a level set - <strong>Neon map containers</strong></a></li>
<li><a href="#stencilContainers">Computing the grad of the level set field - <strong>Neon stencil containers</strong></a></li>
</ol>
<p>The complete tutorial is located in the <code>Neon/tutorials/introduction/domainLevel</code> directory. However, in the following,
we&rsquo;ll start with an empty main function in <code>domainLevel.cpp</code> and will guide you step by step in the tutorial.</p>
<p><a name="backend"></p>
<h3 id="neon-backend-choosing-the-hardware-for-the-computation"><strong>Neon backend</strong>: choosing the hardware for the computation</h3>
<p></a></p>
<p>First, we specify the hardware we want to use. The selection process is introduced in the Set Level section.
Just briefly, through a <code>Neon::Backend</code> object, we declare the runtime type (CUDA streams or OpenMP) and a list of
resources IDs.
In this example, we target the first GPU in the system as it&rsquo;s a typical configuration.
However, we overbook the GPU three times to showcase the multi-GPU capabilities.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Performance wise, you should never overbook a GPU. 
However it is a nice debugging configuration to check multi-GPU mechanism using a single GPU. </p>
</div>
<p>The resulting code is quite simple.
Before exiting we also log some hardware information on the terminal to check that everything is as expected.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Neon/tutorials/introduction/domainLevel/domainLevel.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">**</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="w">    </span><span class="c1">// Step 1 -&gt; Neon backend: choosing the hardware for the computation</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="n">Neon</span><span class="o">::</span><span class="n">init</span><span class="p">();</span><span class="w"></span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="w">    </span><span class="c1">// auto runtime = Neon::Runtime::openmp;</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Neon</span><span class="o">::</span><span class="n">Runtime</span><span class="o">::</span><span class="n">stream</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="w">    </span><span class="c1">// We are overbooking GPU 0 three times</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="n">gpu_ids</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">};</span><span class="w"></span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="n">Neon</span><span class="o">::</span><span class="n">Backend</span><span class="w">    </span><span class="n">backend</span><span class="p">(</span><span class="n">gpu_ids</span><span class="p">,</span><span class="w"> </span><span class="n">runtime</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="w">    </span><span class="c1">// Printing some information</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">    </span><span class="n">NEON_INFO</span><span class="p">(</span><span class="n">backend</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span><span class="w"></span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Remember always to call <code>Neon::init();</code> to ensure that the Neon runtime has been initialized. 
The function can be call more than once. </p>
</div>
<p>Running our first draft of the tutorial produce the following on the terminal:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Execution output</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a>$ ./tutorial-domainLevel 
<a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="o">[</span><span class="m">12</span>:24:56<span class="o">]</span> Neon: CpuSys_t: Loading info on CPU subsystem
<a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="o">[</span><span class="m">12</span>:24:57<span class="o">]</span> Neon: GpuSys_t: Loading info on GPU subsystem <span class="m">1</span> GPU was detected.
<a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="hll"><span class="o">[</span><span class="m">12</span>:24:57<span class="o">]</span> Neon: Backend_t <span class="o">(</span>0x7fffdf107860<span class="o">)</span> - <span class="o">[</span>runtime:stream<span class="o">]</span> <span class="o">[</span>nDev:1<span class="o">]</span> <span class="o">[</span>dev0:0 NVIDIARTXA4000<span class="o">]</span> 
</span></code></pre></div></td></tr></table></div>
<p>In particular, the last line describes the selected backend by providing the type, the number of devices as well as the
device name.
In this case, we are working on an Nvidia A4000 GPU.</p>
<p><a name="cartesian"></p>
<h3 id="neon-grid-setting-up-the-cartesian-discretisation"><strong>Neon grid</strong>: setting up the cartesian discretisation</h3>
<p></a></p>
<p>Now we define a cartesian discretization for our problem.
The main information to provide is:</p>
<ul>
<li>dimension of the discretization box,</li>
<li>cells of interest in the discretization box,</li>
<li>hardware to be used for any computation.</li>
</ul>
<p>During the grid initialization, a stencil may be seen as an uncommon parameter to provide. The stencil is the union of
all the stencils that will be used on the grid. Neon needs to know such parameters because they are critical for many
optimization aspects.
In our example, the only stencil we use is the Jacobi to compute the grad of a level set.</p>
<p>The grid initialization extends the main function in <code>domainLevel.cpp</code> with the following lines:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Neon/tutorials/introduction/domainLevel/domainLevel.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-36">36</a></span>
<span class="normal"><a href="#__codelineno-2-37">37</a></span>
<span class="normal"><a href="#__codelineno-2-38">38</a></span>
<span class="normal"><a href="#__codelineno-2-39">39</a></span>
<span class="normal"><a href="#__codelineno-2-40">40</a></span>
<span class="normal"><a href="#__codelineno-2-41">41</a></span>
<span class="normal"><a href="#__codelineno-2-42">42</a></span>
<span class="normal"><a href="#__codelineno-2-43">43</a></span>
<span class="normal"><a href="#__codelineno-2-44">44</a></span>
<span class="normal"><a href="#__codelineno-2-45">45</a></span>
<span class="normal"><a href="#__codelineno-2-46">46</a></span>
<span class="normal"><a href="#__codelineno-2-47">47</a></span>
<span class="normal"><a href="#__codelineno-2-48">48</a></span>
<span class="normal"><a href="#__codelineno-2-49">49</a></span>
<span class="normal"><a href="#__codelineno-2-50">50</a></span>
<span class="normal"><a href="#__codelineno-2-51">51</a></span>
<span class="normal"><a href="#__codelineno-2-52">52</a></span>
<span class="normal"><a href="#__codelineno-2-53">53</a></span>
<span class="normal"><a href="#__codelineno-2-54">54</a></span>
<span class="normal"><a href="#__codelineno-2-55">55</a></span>
<span class="normal"><a href="#__codelineno-2-56">56</a></span>
<span class="normal"><a href="#__codelineno-2-57">57</a></span>
<span class="normal"><a href="#__codelineno-2-58">58</a></span>
<span class="normal"><a href="#__codelineno-2-59">59</a></span>
<span class="normal"><a href="#__codelineno-2-60">60</a></span>
<span class="normal"><a href="#__codelineno-2-61">61</a></span>
<span class="normal"><a href="#__codelineno-2-62">62</a></span>
<span class="normal"><a href="#__codelineno-2-63">63</a></span>
<span class="normal"><a href="#__codelineno-2-64">64</a></span>
<span class="normal"><a href="#__codelineno-2-65">65</a></span>
<span class="normal"><a href="#__codelineno-2-66">66</a></span>
<span class="normal"><a href="#__codelineno-2-67">67</a></span>
<span class="normal"><a href="#__codelineno-2-68">68</a></span>
<span class="normal"><a href="#__codelineno-2-69">69</a></span>
<span class="normal"><a href="#__codelineno-2-70">70</a></span>
<span class="normal"><a href="#__codelineno-2-71">71</a></span>
<span class="normal"><a href="#__codelineno-2-72">72</a></span>
<span class="normal"><a href="#__codelineno-2-73">73</a></span>
<span class="normal"><a href="#__codelineno-2-74">74</a></span>
<span class="normal"><a href="#__codelineno-2-75">75</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-36" name="__codelineno-2-36"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-2-37" name="__codelineno-2-37"></a>
<a id="__codelineno-2-38" name="__codelineno-2-38"></a><span class="w">    </span><span class="c1">// Step 2 -&gt; Neon grid: setting up a dense cartesian domain</span>
<a id="__codelineno-2-39" name="__codelineno-2-39"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">int32_t</span><span class="w">  </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">25</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-2-40" name="__codelineno-2-40"></a><span class="w">    </span><span class="n">Neon</span><span class="o">::</span><span class="n">index_3d</span><span class="w"> </span><span class="nf">dim</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span><span class="w">     </span><span class="c1">// Size of the domain</span>
<a id="__codelineno-2-41" name="__codelineno-2-41"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w">   </span><span class="n">voxelEdge</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span><span class="w">  </span><span class="c1">// Size of a voxel edge</span>
<a id="__codelineno-2-42" name="__codelineno-2-42"></a>
<a id="__codelineno-2-43" name="__codelineno-2-43"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">Grid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Neon</span><span class="o">::</span><span class="n">domain</span><span class="o">::</span><span class="n">eGrid</span><span class="p">;</span><span class="w">  </span><span class="c1">// Selecting one of the grid provided by Neon</span>
<a id="__codelineno-2-44" name="__codelineno-2-44"></a><span class="w">    </span><span class="n">Neon</span><span class="o">::</span><span class="n">domain</span><span class="o">::</span><span class="n">Stencil</span><span class="w"> </span><span class="n">gradStencil</span><span class="p">([]</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-45" name="__codelineno-2-45"></a><span class="w">        </span><span class="c1">// We use a center difference scheme to compute the grad</span>
<a id="__codelineno-2-46" name="__codelineno-2-46"></a><span class="w">        </span><span class="c1">// The order of the points is important,</span>
<a id="__codelineno-2-47" name="__codelineno-2-47"></a><span class="w">        </span><span class="c1">// as we&#39;ll leverage the specific order when computing the grad.</span>
<a id="__codelineno-2-48" name="__codelineno-2-48"></a><span class="w">        </span><span class="c1">// First positive direction on x, y and z,</span>
<a id="__codelineno-2-49" name="__codelineno-2-49"></a><span class="w">        </span><span class="c1">// then negative direction on x, y, z respectively.</span>
<a id="__codelineno-2-50" name="__codelineno-2-50"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Neon</span><span class="o">::</span><span class="n">index_3d</span><span class="o">&gt;</span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-51" name="__codelineno-2-51"></a><span class="w">            </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-2-52" name="__codelineno-2-52"></a><span class="w">            </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-2-53" name="__codelineno-2-53"></a><span class="w">            </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-2-54" name="__codelineno-2-54"></a><span class="w">            </span><span class="p">{</span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-2-55" name="__codelineno-2-55"></a><span class="w">            </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-2-56" name="__codelineno-2-56"></a><span class="w">            </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">-1</span><span class="p">}};</span><span class="w"></span>
<a id="__codelineno-2-57" name="__codelineno-2-57"></a><span class="w">    </span><span class="p">}());</span><span class="w"></span>
<a id="__codelineno-2-58" name="__codelineno-2-58"></a>
<a id="__codelineno-2-59" name="__codelineno-2-59"></a><span class="w">    </span><span class="c1">// Actual Neon grid allocation</span>
<a id="__codelineno-2-60" name="__codelineno-2-60"></a><span class="w">    </span><span class="n">Grid</span><span class="w"> </span><span class="nf">grid</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-2-61" name="__codelineno-2-61"></a><span class="w">        </span><span class="n">backend</span><span class="p">,</span><span class="w">  </span><span class="c1">// &lt;- Passing the target hardware for the computation</span>
<a id="__codelineno-2-62" name="__codelineno-2-62"></a><span class="w">        </span><span class="n">dim</span><span class="p">,</span><span class="w">      </span><span class="c1">// &lt;- Dimension of the regular grid used for the discretizasion.</span>
<a id="__codelineno-2-63" name="__codelineno-2-63"></a><span class="w">        </span><span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">Neon</span><span class="o">::</span><span class="n">index_3d</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-2-64" name="__codelineno-2-64"></a><span class="w">            </span><span class="c1">// We are looking for a dense domain,</span>
<a id="__codelineno-2-65" name="__codelineno-2-65"></a><span class="w">            </span><span class="c1">// so we are interested in all the points in the grid.</span>
<a id="__codelineno-2-66" name="__codelineno-2-66"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-2-67" name="__codelineno-2-67"></a><span class="w">        </span><span class="p">},</span><span class="w">             </span><span class="c1">// &lt;-  defining the active cells.</span>
<a id="__codelineno-2-68" name="__codelineno-2-68"></a><span class="w">        </span><span class="n">gradStencil</span><span class="p">);</span><span class="w">  </span><span class="c1">// &lt;- Stencil that will be used during computations on the grid</span>
<a id="__codelineno-2-69" name="__codelineno-2-69"></a>
<a id="__codelineno-2-70" name="__codelineno-2-70"></a><span class="w">    </span><span class="c1">// Exporting some information</span>
<a id="__codelineno-2-71" name="__codelineno-2-71"></a><span class="w">    </span><span class="n">NEON_INFO</span><span class="p">(</span><span class="n">grid</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span><span class="w"></span>
<a id="__codelineno-2-72" name="__codelineno-2-72"></a><span class="w">    </span><span class="n">grid</span><span class="p">.</span><span class="n">ioDomainToVtk</span><span class="p">(</span><span class="s">&quot;domain&quot;</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-2-73" name="__codelineno-2-73"></a>
<a id="__codelineno-2-74" name="__codelineno-2-74"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-2-75" name="__codelineno-2-75"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p>Running again our tutorial with the added code we obtain the following output:</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Execution output</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span>
<span class="normal"><a href="#__codelineno-3-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a>$ ./tutorial-domainLevel 
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="o">[</span><span class="m">12</span>:54:11<span class="o">]</span> Neon: CpuSys_t: Loading info on CPU subsystem
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="o">[</span><span class="m">12</span>:54:11<span class="o">]</span> Neon: GpuSys_t: Loading info on GPU subsystem <span class="m">1</span> GPU was detected.
<a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="o">[</span><span class="m">12</span>:54:11<span class="o">]</span> Neon: Backend_t <span class="o">(</span>0x7ffc0e6fad20<span class="o">)</span> - <span class="o">[</span>runtime:stream<span class="o">]</span> <span class="o">[</span>nDev:1<span class="o">]</span> <span class="o">[</span>dev0:0 NVIDIARTXA4000<span class="o">]</span> 
<a id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="hll"><span class="o">[</span><span class="m">12</span>:54:12<span class="o">]</span> Neon: <span class="o">[</span>Domain Grid<span class="o">]</span>:<span class="o">{</span>eGrid<span class="o">}</span>, <span class="o">[</span>Background Grid<span class="o">]</span>:<span class="o">{(</span><span class="m">25</span>, <span class="m">25</span>, <span class="m">25</span><span class="o">)}</span>, <span class="o">[</span>Active Cells<span class="o">]</span>:<span class="o">{</span><span class="m">15625</span><span class="o">}</span>, <span class="o">[</span>Cell Distribution<span class="o">]</span>:<span class="o">{(</span><span class="m">15625</span><span class="o">)}</span>, <span class="o">[</span>Backend<span class="o">]</span>:<span class="o">{</span>Backend_t <span class="o">(</span>0x55e6f57a2c70<span class="o">)</span> - <span class="o">[</span>runtime:stream<span class="o">]</span> <span class="o">[</span>nDev:1<span class="o">]</span> <span class="o">[</span>dev0:0 NVIDIARTXA4000<span class="o">]</span> <span class="o">}</span>
</span></code></pre></div></td></tr></table></div>
<p>By logging the grid information (<code>NEON_INFO(grid.toString());</code>), we can inspect some information about the grid.
The last terminal line shows the selected grid type (eGrid in this case), the dimension of the grid, the number of
active cells, as well as the number of cells per hardware device.</p>
<p>By calling <code>ioDomainToVtk</code> method, we can also inspect the created domain (<code>grid</code>) via Paraview as the code generates a
vtk
file (<code>myDomain</code>). With an application working on a dense domain, the Paraview will show all the cells in the
discretization box as active.
Moreover, it will show the mapping between cells and hardware devices as
reported in the following picture:</p>
<p><img alt="Mapping between cells and hardware devices" src="../img/04-domain.vtk.png" /></p>
<p><a name="field"></p>
<h3 id="neon-field-defining-data-over-the-cartesian-discretisation"><strong>Neon field</strong>: defining data over the cartesian discretisation</h3>
<p></a></p>
<p>Let&rsquo;s now allocate some metadata on top of the cartesian discretization we have just creates.
Neon field are the tool for the task. Fields are allocated from a Neon grid.
The type of a field depends on the metadata store on each cell.
A field can allocate a number of components for each cell. This number of components
which we call cardinality is defined when the field is created.</p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Neon/tutorials/introduction/domainLevel/domainLevel.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-72">72</a></span>
<span class="normal"><a href="#__codelineno-4-73">73</a></span>
<span class="normal"><a href="#__codelineno-4-74">74</a></span>
<span class="normal"><a href="#__codelineno-4-75">75</a></span>
<span class="normal"><a href="#__codelineno-4-76">76</a></span>
<span class="normal"><a href="#__codelineno-4-77">77</a></span>
<span class="normal"><a href="#__codelineno-4-78">78</a></span>
<span class="normal"><a href="#__codelineno-4-79">79</a></span>
<span class="normal"><a href="#__codelineno-4-80">80</a></span>
<span class="normal"><a href="#__codelineno-4-81">81</a></span>
<span class="normal"><a href="#__codelineno-4-82">82</a></span>
<span class="normal"><a href="#__codelineno-4-83">83</a></span>
<span class="normal"><a href="#__codelineno-4-84">84</a></span>
<span class="normal"><a href="#__codelineno-4-85">85</a></span>
<span class="normal"><a href="#__codelineno-4-86">86</a></span>
<span class="normal"><a href="#__codelineno-4-87">87</a></span>
<span class="normal"><a href="#__codelineno-4-88">88</a></span>
<span class="normal"><a href="#__codelineno-4-89">89</a></span>
<span class="normal"><a href="#__codelineno-4-90">90</a></span>
<span class="normal"><a href="#__codelineno-4-91">91</a></span>
<span class="normal"><a href="#__codelineno-4-92">92</a></span>
<span class="normal"><a href="#__codelineno-4-93">93</a></span>
<span class="normal"><a href="#__codelineno-4-94">94</a></span>
<span class="normal"><a href="#__codelineno-4-95">95</a></span>
<span class="normal"><a href="#__codelineno-4-96">96</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-72" name="__codelineno-4-72"></a><span class="w">    </span><span class="c1">//...</span>
<a id="__codelineno-4-73" name="__codelineno-4-73"></a>
<a id="__codelineno-4-74" name="__codelineno-4-74"></a><span class="w">    </span><span class="c1">// Step 3 -&gt; Neon field: initializing a sphere through its signed distance function</span>
<a id="__codelineno-4-75" name="__codelineno-4-75"></a>
<a id="__codelineno-4-76" name="__codelineno-4-76"></a><span class="w">    </span><span class="c1">// Creating a scalar field over the grid.</span>
<a id="__codelineno-4-77" name="__codelineno-4-77"></a><span class="w">    </span><span class="c1">// Inactive cells will get associated with a default value of -100 */</span>
<a id="__codelineno-4-78" name="__codelineno-4-78"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">sphereSdf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="p">.</span><span class="n">newField</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;sphereSdf&quot;</span><span class="p">,</span><span class="w">  </span><span class="c1">// &lt;- Given name of the field.</span>
<a id="__codelineno-4-79" name="__codelineno-4-79"></a><span class="w">                                           </span><span class="mi">1</span><span class="p">,</span><span class="w">            </span><span class="c1">// &lt;- Number of field&#39;s component per grid point.</span>
<a id="__codelineno-4-80" name="__codelineno-4-80"></a><span class="w">                                           </span><span class="mi">-100</span><span class="p">);</span><span class="w">        </span><span class="c1">// &lt;- Default value for non active points.</span>
<a id="__codelineno-4-81" name="__codelineno-4-81"></a>
<a id="__codelineno-4-82" name="__codelineno-4-82"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">voxelEdge</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">.3</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-4-83" name="__codelineno-4-83"></a>
<a id="__codelineno-4-84" name="__codelineno-4-84"></a><span class="w">    </span><span class="c1">// Using the signed distance function of a sphere to initialize the field&#39;s values</span>
<a id="__codelineno-4-85" name="__codelineno-4-85"></a><span class="w">    </span><span class="c1">// We leverage the forEachActiveCell method to easily iterate over the active cells.</span>
<a id="__codelineno-4-86" name="__codelineno-4-86"></a><span class="w">    </span><span class="n">sphereSdf</span><span class="p">.</span><span class="n">forEachActiveCell</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="n">Neon</span><span class="o">::</span><span class="n">index_3d</span><span class="o">&amp;</span><span class="w"> </span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-4-87" name="__codelineno-4-87"></a><span class="w">        </span><span class="kt">double</span><span class="w"> </span><span class="n">sdf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sdfCenteredSphere</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="n">dim</span><span class="p">,</span><span class="w"> </span><span class="n">voxelEdge</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-4-88" name="__codelineno-4-88"></a><span class="w">        </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sdf</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-4-89" name="__codelineno-4-89"></a><span class="w">    </span><span class="p">});</span><span class="w"></span>
<a id="__codelineno-4-90" name="__codelineno-4-90"></a>
<a id="__codelineno-4-91" name="__codelineno-4-91"></a><span class="w">    </span><span class="c1">// Exporting some information of the sdf on terminal and on a vtk file. </span>
<a id="__codelineno-4-92" name="__codelineno-4-92"></a><span class="w">    </span><span class="n">NEON_INFO</span><span class="p">(</span><span class="n">sphereSdf</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span><span class="w"></span>
<a id="__codelineno-4-93" name="__codelineno-4-93"></a><span class="w">    </span><span class="n">sphereSdf</span><span class="p">.</span><span class="n">ioToVtk</span><span class="p">(</span><span class="s">&quot;sdf&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;sdf&quot;</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-4-94" name="__codelineno-4-94"></a>
<a id="__codelineno-4-95" name="__codelineno-4-95"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-4-96" name="__codelineno-4-96"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p><img alt="" src="../img/04-initial-sdf.png" /></p>
<p><a name="mapContainers"></p>
<h3 id="neon-map-containers-expanding-the-sphere-via-a-level-set"><strong>Neon map containers</strong>: expanding the sphere via a level set</h3>
<p></a></p>
<p>Let&rsquo;s now manipulate the sdf to expand zero level set of the sphere.
The operation can be simply implemented by adding a constant to all the cells of the grid.
The result will be a level set field (not a signed distance function).</p>
<p>Until now the values of the <code>sphereSdf</code> field are stored on the host,
indeed working on the host side is the only way we can do IO type of operations.
The process of moving data to the devices is simple as it requires only a simple mehtod call.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>All Neon operation related to runnig computation or moving data have a asynchronous semantic.
At the domain level it is up to the user to handle any sort of synchronization manually. </p>
</div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Neon/tutorials/introduction/domainLevel/domainLevel.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-5-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-5-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-5-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-5-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-5-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-5-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-5-100">100</a></span>
<span class="normal"><a href="#__codelineno-5-101">101</a></span>
<span class="normal"><a href="#__codelineno-5-102">102</a></span>
<span class="normal"><a href="#__codelineno-5-103">103</a></span>
<span class="normal"><a href="#__codelineno-5-104">104</a></span>
<span class="normal"><a href="#__codelineno-5-105">105</a></span>
<span class="normal"><a href="#__codelineno-5-106">106</a></span>
<span class="normal"><a href="#__codelineno-5-107">107</a></span>
<span class="normal"><a href="#__codelineno-5-108">108</a></span>
<span class="normal"><a href="#__codelineno-5-109">109</a></span>
<span class="normal"><a href="#__codelineno-5-110">110</a></span>
<span class="normal"><a href="#__codelineno-5-111">111</a></span>
<span class="normal"><a href="#__codelineno-5-112">112</a></span>
<span class="normal"><a href="#__codelineno-5-113">113</a></span>
<span class="normal"><a href="#__codelineno-5-114">114</a></span>
<span class="normal"><a href="#__codelineno-5-115">115</a></span>
<span class="normal"><a href="#__codelineno-5-116">116</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-93" name="__codelineno-5-93"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-5-94" name="__codelineno-5-94"></a>
<a id="__codelineno-5-95" name="__codelineno-5-95"></a><span class="w">    </span><span class="c1">// Step 4 -&gt; Neon map containers: expanding the sphere via a level set</span>
<a id="__codelineno-5-96" name="__codelineno-5-96"></a>
<a id="__codelineno-5-97" name="__codelineno-5-97"></a><span class="w">    </span><span class="c1">// loading the sphereSdf to device</span>
<a id="__codelineno-5-98" name="__codelineno-5-98"></a><span class="w">    </span><span class="n">sphereSdf</span><span class="p">.</span><span class="n">updateCompute</span><span class="p">(</span><span class="n">Neon</span><span class="o">::</span><span class="n">Backend</span><span class="o">::</span><span class="n">mainStreamIdx</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-5-99" name="__codelineno-5-99"></a>
<a id="__codelineno-5-100" name="__codelineno-5-100"></a><span class="w">    </span><span class="c1">// Run a container that ads a value to the sphere sdf</span>
<a id="__codelineno-5-101" name="__codelineno-5-101"></a><span class="w">    </span><span class="c1">// The result is a level set of an expanded sphere (not more a sdf)</span>
<a id="__codelineno-5-102" name="__codelineno-5-102"></a><span class="w">    </span><span class="c1">// We run the container asynchronously on the main stream</span>
<a id="__codelineno-5-103" name="__codelineno-5-103"></a><span class="w">    </span><span class="n">expandedLevelSet</span><span class="p">(</span><span class="n">sphereSdf</span><span class="p">,</span><span class="w"> </span><span class="mf">5.0</span><span class="p">).</span><span class="n">run</span><span class="p">(</span><span class="n">Neon</span><span class="o">::</span><span class="n">Backend</span><span class="o">::</span><span class="n">mainStreamIdx</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-5-104" name="__codelineno-5-104"></a>
<a id="__codelineno-5-105" name="__codelineno-5-105"></a><span class="w">    </span><span class="c1">// Moving asynchronously the values of the newly computed level set back</span>
<a id="__codelineno-5-106" name="__codelineno-5-106"></a><span class="w">    </span><span class="c1">// to export the result to vtk.</span>
<a id="__codelineno-5-107" name="__codelineno-5-107"></a><span class="w">    </span><span class="n">sphereSdf</span><span class="p">.</span><span class="n">updateIO</span><span class="p">(</span><span class="n">Neon</span><span class="o">::</span><span class="n">Backend</span><span class="o">::</span><span class="n">mainStreamIdx</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-5-108" name="__codelineno-5-108"></a>
<a id="__codelineno-5-109" name="__codelineno-5-109"></a><span class="w">    </span><span class="c1">// Waiting for the transfer to complete.</span>
<a id="__codelineno-5-110" name="__codelineno-5-110"></a><span class="w">    </span><span class="n">backend</span><span class="p">.</span><span class="n">sync</span><span class="p">(</span><span class="n">Neon</span><span class="o">::</span><span class="n">Backend</span><span class="o">::</span><span class="n">mainStreamIdx</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-5-111" name="__codelineno-5-111"></a>
<a id="__codelineno-5-112" name="__codelineno-5-112"></a><span class="w">    </span><span class="c1">// Exporting once again the fiel to vtk</span>
<a id="__codelineno-5-113" name="__codelineno-5-113"></a><span class="w">    </span><span class="n">sphereSdf</span><span class="p">.</span><span class="n">ioToVtk</span><span class="p">(</span><span class="s">&quot;expandedLevelSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;expandedLevelSet&quot;</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-5-114" name="__codelineno-5-114"></a>
<a id="__codelineno-5-115" name="__codelineno-5-115"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-5-116" name="__codelineno-5-116"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Neon/tutorials/introduction/domainLevel/expandSphere.cu</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span>
<span class="normal"><a href="#__codelineno-6-15">15</a></span>
<span class="normal"><a href="#__codelineno-6-16">16</a></span>
<span class="normal"><a href="#__codelineno-6-17">17</a></span>
<span class="normal"><a href="#__codelineno-6-18">18</a></span>
<span class="normal"><a href="#__codelineno-6-19">19</a></span>
<span class="normal"><a href="#__codelineno-6-20">20</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Field</span><span class="o">&gt;</span><span class="w"></span>
<a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="k">auto</span><span class="w"> </span><span class="n">expandedLevelSet</span><span class="p">(</span><span class="n">Field</span><span class="o">&amp;</span><span class="w"> </span><span class="n">sdf</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">                 </span><span class="kt">double</span><span class="w"> </span><span class="n">expantion</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="o">-&gt;</span><span class="n">Neon</span><span class="o">::</span><span class="n">set</span><span class="o">::</span><span class="n">Container</span><span class="w"></span>
<a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sdf</span><span class="p">.</span><span class="n">getGrid</span><span class="p">().</span><span class="n">getContainer</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="w">        </span><span class="s">&quot;ExpandedLevelSet&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="n">expantion</span><span class="p">](</span><span class="n">Neon</span><span class="o">::</span><span class="n">set</span><span class="o">::</span><span class="n">Loader</span><span class="o">&amp;</span><span class="w"> </span><span class="n">L</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="w">            </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">px</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">sdf</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-6-14" name="__codelineno-6-14"></a>
<a id="__codelineno-6-15" name="__codelineno-6-15"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="n">NEON_CUDA_HOST_DEVICE</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-6-16" name="__codelineno-6-16"></a><span class="w">                       </span><span class="k">const</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">Field</span><span class="o">::</span><span class="n">Cell</span><span class="o">&amp;</span><span class="w"> </span><span class="n">cell</span><span class="p">)</span><span class="w"> </span><span class="k">mutable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-6-17" name="__codelineno-6-17"></a><span class="w">                </span><span class="n">px</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">expantion</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-6-18" name="__codelineno-6-18"></a><span class="w">            </span><span class="p">};</span><span class="w"></span>
<a id="__codelineno-6-19" name="__codelineno-6-19"></a><span class="w">        </span><span class="p">});</span><span class="w"></span>
<a id="__codelineno-6-20" name="__codelineno-6-20"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p><img alt="" src="../img/04-expanded-levelSet.png" /></p>
<p><a name="mapContainstencilContainersers"></p>
<h3 id="neon-stencil-containers-computing-the-grad-of-the-level-set-field">Neon stencil containers: computing the grad of the level set field</h3>
<p></a></p>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Neon/tutorials/introduction/domainLevel/domainLevel.cpp</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-113">113</a></span>
<span class="normal"><a href="#__codelineno-7-114">114</a></span>
<span class="normal"><a href="#__codelineno-7-115">115</a></span>
<span class="normal"><a href="#__codelineno-7-116">116</a></span>
<span class="normal"><a href="#__codelineno-7-117">117</a></span>
<span class="normal"><a href="#__codelineno-7-118">118</a></span>
<span class="normal"><a href="#__codelineno-7-119">119</a></span>
<span class="normal"><a href="#__codelineno-7-120">120</a></span>
<span class="normal"><a href="#__codelineno-7-121">121</a></span>
<span class="normal"><a href="#__codelineno-7-122">122</a></span>
<span class="normal"><a href="#__codelineno-7-123">123</a></span>
<span class="normal"><a href="#__codelineno-7-124">124</a></span>
<span class="normal"><a href="#__codelineno-7-125">125</a></span>
<span class="normal"><a href="#__codelineno-7-126">126</a></span>
<span class="normal"><a href="#__codelineno-7-127">127</a></span>
<span class="normal"><a href="#__codelineno-7-128">128</a></span>
<span class="normal"><a href="#__codelineno-7-129">129</a></span>
<span class="normal"><a href="#__codelineno-7-130">130</a></span>
<span class="normal"><a href="#__codelineno-7-131">131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-7-113" name="__codelineno-7-113"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-7-114" name="__codelineno-7-114"></a>
<a id="__codelineno-7-115" name="__codelineno-7-115"></a><span class="w">    </span><span class="c1">// Step 5 -&gt; Neon stencil containers: computing the grad of the level set field</span>
<a id="__codelineno-7-116" name="__codelineno-7-116"></a>
<a id="__codelineno-7-117" name="__codelineno-7-117"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">grad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">grid</span><span class="p">.</span><span class="n">newField</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;sphereSdf&quot;</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="c1">// &lt;- Given name of the field.</span>
<a id="__codelineno-7-118" name="__codelineno-7-118"></a><span class="w">                                      </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="c1">// &lt;- Number of field&#39;s component per grid point.</span>
<a id="__codelineno-7-119" name="__codelineno-7-119"></a><span class="w">                                      </span><span class="mi">0</span><span class="p">);</span><span class="w"> </span><span class="c1">// &lt;- Default value for non active points.</span>
<a id="__codelineno-7-120" name="__codelineno-7-120"></a>
<a id="__codelineno-7-121" name="__codelineno-7-121"></a><span class="w">    </span><span class="n">Neon</span><span class="o">::</span><span class="n">set</span><span class="o">::</span><span class="n">HuOptions</span><span class="w"> </span><span class="nf">huOptions</span><span class="p">(</span><span class="n">Neon</span><span class="o">::</span><span class="n">set</span><span class="o">::</span><span class="n">TransferMode</span><span class="o">::</span><span class="n">get</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-7-122" name="__codelineno-7-122"></a><span class="w">                                   </span><span class="nb">true</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-7-123" name="__codelineno-7-123"></a><span class="w">    </span><span class="n">sphereSdf</span><span class="p">.</span><span class="n">haloUpdate</span><span class="p">(</span><span class="n">huOptions</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-7-124" name="__codelineno-7-124"></a>
<a id="__codelineno-7-125" name="__codelineno-7-125"></a><span class="w">    </span><span class="n">computeGrad</span><span class="p">(</span><span class="n">sphereSdf</span><span class="p">,</span><span class="w"> </span><span class="n">grad</span><span class="p">,</span><span class="w"> </span><span class="n">voxelEdge</span><span class="p">).</span><span class="n">run</span><span class="p">(</span><span class="n">Neon</span><span class="o">::</span><span class="n">Backend</span><span class="o">::</span><span class="n">mainStreamIdx</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-7-126" name="__codelineno-7-126"></a><span class="w">    </span><span class="n">grad</span><span class="p">.</span><span class="n">updateIO</span><span class="p">(</span><span class="n">Neon</span><span class="o">::</span><span class="n">Backend</span><span class="o">::</span><span class="n">mainStreamIdx</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-7-127" name="__codelineno-7-127"></a><span class="w">    </span><span class="n">backend</span><span class="p">.</span><span class="n">sync</span><span class="p">(</span><span class="n">Neon</span><span class="o">::</span><span class="n">Backend</span><span class="o">::</span><span class="n">mainStreamIdx</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-7-128" name="__codelineno-7-128"></a>
<a id="__codelineno-7-129" name="__codelineno-7-129"></a><span class="w">    </span><span class="n">grad</span><span class="p">.</span><span class="n">ioToVtk</span><span class="p">(</span><span class="s">&quot;grad&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;grad&quot;</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-7-130" name="__codelineno-7-130"></a>
<a id="__codelineno-7-131" name="__codelineno-7-131"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<div class="highlight"><table class="highlighttable"><tr><th colspan="2" class="filename"><span class="filename">Neon/tutorials/introduction/domainLevel/expandSphere.cu</span></th></tr><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span>
<span class="normal"><a href="#__codelineno-8-11">11</a></span>
<span class="normal"><a href="#__codelineno-8-12">12</a></span>
<span class="normal"><a href="#__codelineno-8-13">13</a></span>
<span class="normal"><a href="#__codelineno-8-14">14</a></span>
<span class="normal"><a href="#__codelineno-8-15">15</a></span>
<span class="normal"><a href="#__codelineno-8-16">16</a></span>
<span class="normal"><a href="#__codelineno-8-17">17</a></span>
<span class="normal"><a href="#__codelineno-8-18">18</a></span>
<span class="normal"><a href="#__codelineno-8-19">19</a></span>
<span class="normal"><a href="#__codelineno-8-20">20</a></span>
<span class="normal"><a href="#__codelineno-8-21">21</a></span>
<span class="normal"><a href="#__codelineno-8-22">22</a></span>
<span class="normal"><a href="#__codelineno-8-23">23</a></span>
<span class="normal"><a href="#__codelineno-8-24">24</a></span>
<span class="normal"><a href="#__codelineno-8-25">25</a></span>
<span class="normal"><a href="#__codelineno-8-26">26</a></span>
<span class="normal"><a href="#__codelineno-8-27">27</a></span>
<span class="normal"><a href="#__codelineno-8-28">28</a></span>
<span class="normal"><a href="#__codelineno-8-29">29</a></span>
<span class="normal"><a href="#__codelineno-8-30">30</a></span>
<span class="normal"><a href="#__codelineno-8-31">31</a></span>
<span class="normal"><a href="#__codelineno-8-32">32</a></span>
<span class="normal"><a href="#__codelineno-8-33">33</a></span>
<span class="normal"><a href="#__codelineno-8-34">34</a></span>
<span class="normal"><a href="#__codelineno-8-35">35</a></span>
<span class="normal"><a href="#__codelineno-8-36">36</a></span>
<span class="normal"><a href="#__codelineno-8-37">37</a></span>
<span class="normal"><a href="#__codelineno-8-38">38</a></span>
<span class="normal"><a href="#__codelineno-8-39">39</a></span>
<span class="normal"><a href="#__codelineno-8-40">40</a></span>
<span class="normal"><a href="#__codelineno-8-41">41</a></span>
<span class="normal"><a href="#__codelineno-8-42">42</a></span>
<span class="normal"><a href="#__codelineno-8-43">43</a></span>
<span class="normal"><a href="#__codelineno-8-44">44</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">Field</span><span class="o">&gt;</span><span class="w"></span>
<a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="k">auto</span><span class="w"> </span><span class="n">computeGrad</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Field</span><span class="o">&amp;</span><span class="w"> </span><span class="n">sdfField</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="w">                      </span><span class="n">Field</span><span class="o">&amp;</span><span class="w">       </span><span class="n">gradField</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="w">                      </span><span class="kt">double</span><span class="w">       </span><span class="n">h</span><span class="p">)</span><span class="w"></span>
<a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="w">    </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Neon</span><span class="o">::</span><span class="n">set</span><span class="o">::</span><span class="n">Container</span><span class="w"></span>
<a id="__codelineno-8-11" name="__codelineno-8-11"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">sdfField</span><span class="p">.</span><span class="n">getCardinality</span><span class="p">()</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">gradField</span><span class="p">.</span><span class="n">getCardinality</span><span class="p">()</span><span class="o">!=</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">){</span><span class="w"></span>
<a id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="w">        </span><span class="n">NEON_THROW_UNSUPPORTED_OPERATION</span><span class="p">(</span><span class="s">&quot;Wrong cardinality detected.&quot;</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="w">    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-8-15" name="__codelineno-8-15"></a>
<a id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">sdfField</span><span class="p">.</span><span class="n">getGrid</span><span class="p">().</span><span class="n">getContainer</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="w">        </span><span class="s">&quot;computeGrad&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="p">,</span><span class="w"> </span><span class="n">h</span><span class="p">](</span><span class="n">Neon</span><span class="o">::</span><span class="n">set</span><span class="o">::</span><span class="n">Loader</span><span class="o">&amp;</span><span class="w"> </span><span class="n">L</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="w">            </span><span class="k">auto</span><span class="o">&amp;</span><span class="w">      </span><span class="n">sdf</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">sdfField</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="w">            </span><span class="k">auto</span><span class="o">&amp;</span><span class="w">      </span><span class="n">grad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">L</span><span class="p">.</span><span class="n">load</span><span class="p">(</span><span class="n">gradField</span><span class="p">,</span><span class="w"> </span><span class="n">Neon</span><span class="o">::</span><span class="n">Compute</span><span class="o">::</span><span class="n">STENCIL</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-8-20" name="__codelineno-8-20"></a><span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">twiceOverH</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">h</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-8-21" name="__codelineno-8-21"></a>
<a id="__codelineno-8-22" name="__codelineno-8-22"></a>
<a id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="n">NEON_CUDA_HOST_DEVICE</span><span class="p">(</span><span class="w"></span>
<a id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="w">                       </span><span class="k">const</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">Field</span><span class="o">::</span><span class="n">Cell</span><span class="o">&amp;</span><span class="w"> </span><span class="n">cell</span><span class="p">)</span><span class="w"> </span><span class="k">mutable</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="w">                </span><span class="c1">// Central difference</span>
<a id="__codelineno-8-26" name="__codelineno-8-26"></a><span class="w">                </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="w">                    </span><span class="k">auto</span><span class="w"> </span><span class="n">upIdx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="w">                    </span><span class="k">auto</span><span class="w"> </span><span class="n">dwIdx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-8-29" name="__codelineno-8-29"></a>
<a id="__codelineno-8-30" name="__codelineno-8-30"></a><span class="w">                    </span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">valUp</span><span class="p">,</span><span class="w"> </span><span class="n">isValidUp</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sdf</span><span class="p">.</span><span class="n">nghVal</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="n">upIdx</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-8-31" name="__codelineno-8-31"></a><span class="w">                    </span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">valDw</span><span class="p">,</span><span class="w"> </span><span class="n">isValidDw</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sdf</span><span class="p">.</span><span class="n">nghVal</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="n">dwIdx</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<a id="__codelineno-8-32" name="__codelineno-8-32"></a>
<a id="__codelineno-8-33" name="__codelineno-8-33"></a><span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isValidUp</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="n">isValidDw</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-8-34" name="__codelineno-8-34"></a><span class="w">                        </span><span class="n">grad</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-8-35" name="__codelineno-8-35"></a><span class="w">                        </span><span class="n">grad</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-8-36" name="__codelineno-8-36"></a><span class="w">                        </span><span class="n">grad</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-8-37" name="__codelineno-8-37"></a><span class="w">                        </span><span class="k">break</span><span class="w"> </span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-8-38" name="__codelineno-8-38"></a><span class="w">                    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-8-39" name="__codelineno-8-39"></a><span class="w">                        </span><span class="n">grad</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">valUp</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">valDw</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">twiceOverH</span><span class="p">;</span><span class="w"></span>
<a id="__codelineno-8-40" name="__codelineno-8-40"></a><span class="w">                    </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-8-41" name="__codelineno-8-41"></a><span class="w">                </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-8-42" name="__codelineno-8-42"></a><span class="w">            </span><span class="p">};</span><span class="w"></span>
<a id="__codelineno-8-43" name="__codelineno-8-43"></a><span class="w">        </span><span class="p">});</span><span class="w"></span>
<a id="__codelineno-8-44" name="__codelineno-8-44"></a><span class="p">}</span><span class="w"></span>
</code></pre></div></td></tr></table></div>
<p><img alt="" src="../img/04-grad.png" /></p>




              
            </article>
            
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../03-the-set-level/" class="md-footer__link md-footer__link--prev" aria-label="Previous: The Set Level" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              The Set Level
            </div>
          </div>
        </a>
      
      
        
        <a href="../05-the-skeleton-level/" class="md-footer__link md-footer__link--next" aria-label="Next: The Skeleton Level" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              The Skeleton Level
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "search": "../../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.9c69f0bc.min.js"></script>
      
        <script src="../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>